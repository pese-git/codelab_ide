# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: Loader –≤–º–µ—Å—Ç–æ —Ñ–æ—Ä–º—ã —á–∞—Ç–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å–µ—Å—Å–∏–∏

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Å–µ—Å—Å–∏–∏ –∏–∑ —Å–ø–∏—Å–∫–∞ —Ñ–æ—Ä–º–∞ —á–∞—Ç–∞ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∞—Å—å - –≤–º–µ—Å—Ç–æ –Ω–µ–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª—Å—è loader –Ω–∞ –≤—Å—é –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞, —Ö–æ—Ç—è –≤ –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ, —á—Ç–æ:
- –°–µ—Å—Å–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- WebSocket –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è
- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (0 —Å–æ–æ–±—â–µ–Ω–∏–π)
- Pending approvals –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è

```
flutter: ‚îÇ üêõ [SessionManagerBloc] üîç Selecting session: session_83920be693064446
flutter: ‚îÇ üí° [SessionManagerBloc] ‚úÖ Selected session: session_83920be693064446
flutter: ‚îÇ üêõ [AgentChatBloc] üîå Connecting to session: session_83920be693064446
flutter: ‚îÇ üí° Connected to WebSocket: session_83920be693064446
flutter: ‚îÇ üí° Loaded 0 messages
```

## –ü—Ä–∏—á–∏–Ω–∞

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ —Ç–æ–º, —á—Ç–æ callback `onSessionSelected` –≤—ã–∑—ã–≤–∞–ª—Å—è –∏–∑ **listener** –≤ [`SessionListPage`](lib/features/session_management/presentation/pages/session_list_page.dart), –∫–æ—Ç–æ—Ä—ã–π —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç **–ø–æ—Å–ª–µ** —Ç–æ–≥–æ, –∫–∞–∫ `SessionManagerBloc` –ø–µ—Ä–µ—à–µ–ª –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `loading`.

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π (–ø—Ä–æ–±–ª–µ–º–Ω–∞—è):

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ —Å–µ—Å—Å–∏—é –≤ `SessionCard`
2. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `sessionManagerBloc.add(SessionManagerEvent.selectSession(session.id))`
3. `SessionManagerBloc` **–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ** –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ `loading()` —Å–æ—Å—Ç–æ—è–Ω–∏–µ (—Å—Ç—Ä–æ–∫–∞ 130 –≤ session_manager_bloc.dart)
4. `SessionListPage` **–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `ProgressRing` (—Å—Ç—Ä–æ–∫–∞ 67)
5. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç loader –Ω–∞ –≤—Å—é –æ–±–ª–∞—Å—Ç—å**
6. `SessionManagerBloc` –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–µ—Å—Å–∏—é —Å —Å–µ—Ä–≤–µ—Ä–∞
7. `SessionManagerBloc` –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ `sessionSwitched()` —Å–æ—Å—Ç–æ—è–Ω–∏–µ
8. **–¢–æ–ª—å–∫–æ —Ç–µ–ø–µ—Ä—å** listener –≤—ã–∑—ã–≤–∞–µ—Ç `onSessionSelected(session)`
9. `AiAssistantPanel` –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç `_showChat = true`
10. `AnimatedSwitcher` –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ `ChatPage`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ–∂–¥—É —à–∞–≥–∞–º–∏ 3 –∏ 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç loader.

## –†–µ—à–µ–Ω–∏–µ

–í—ã–∑—ã–≤–∞—Ç—å `onSessionSelected` **—Å—Ä–∞–∑—É** –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å–µ—Å—Å–∏—é, –∞ –Ω–µ –∂–¥–∞—Ç—å listener:

### –í `SessionListPage`:

```dart
onTap: isCurrent
    ? null
    : () {
        // ‚úÖ –°—Ä–∞–∑—É –≤—ã–∑—ã–≤–∞–µ–º callback, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–∫–∞–∑–∞ loader
        onSessionSelected(session);
        // –ó–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –≤ bloc –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
        sessionManagerBloc.add(
          SessionManagerEvent.selectSession(session.id),
        );
      },
```

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è):

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ —Å–µ—Å—Å–∏—é –≤ `SessionCard`
2. **–°—Ä–∞–∑—É –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `onSessionSelected(session)`**
3. **`AiAssistantPanel` –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç `_showChat = true`**
4. **`AnimatedSwitcher` –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ `ChatPage`**
5. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç `ChatPage` —Å empty state –∏–ª–∏ loader –≤ –∫–Ω–æ–ø–∫–µ**
6. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `sessionManagerBloc.add(SessionManagerEvent.selectSession(session.id))`
7. `SessionManagerBloc` –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ `loading()` —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω–æ —ç—Ç–æ —É–∂–µ –Ω–µ –≤–∞–∂–Ω–æ, —Ç.–∫. `SessionListPage` –Ω–µ –≤–∏–¥–Ω–∞)
8. `AgentChatBloc` –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Å—Å–∏–∏ –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç `ChatPage`, –∞ –Ω–µ loader –Ω–∞ –≤—Å—é –æ–±–ª–∞—Å—Ç—å.

## –ò–∑–º–µ–Ω–µ–Ω–∏—è

### –§–∞–π–ª: `lib/features/session_management/presentation/pages/session_list_page.dart`

1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω `onTap` –≤ SessionCard** (—Å—Ç—Ä–æ–∫–∏ 196-213):
   - Callback `onSessionSelected` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **—Å—Ä–∞–∑—É** –ø—Ä–∏ –∫–ª–∏–∫–µ
   - –ó–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ –≤ `SessionManagerBloc`
   - –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º

2. **–£–±—Ä–∞–Ω `sessionSwitched` –∏–∑ listener** (—Å—Ç—Ä–æ–∫–∏ 36-50):
   - Listener –±–æ–ª—å—à–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç `onSessionSelected`
   - –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥–≤–æ–π–Ω–æ–π –≤—ã–∑–æ–≤ callback

### –§–∞–π–ª: `lib/features/agent_chat/presentation/widgets/ai_assistant_panel.dart`

1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω `onSessionSelected`** (—Å—Ç—Ä–æ–∫–∏ 116-126):
   - `setState` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–ø–µ—Ä–≤—ã–º** –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è UI
   - –ó–∞—Ç–µ–º –≤—ã–∑—ã–≤–∞—é—Ç—Å—è —Å–æ–±—ã—Ç–∏—è `AgentChatBloc`
   - –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º

2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω `onNewSession`** (—Å—Ç—Ä–æ–∫–∏ 127-135):
   - `setState` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–ø–µ—Ä–≤—ã–º** –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è UI
   - –ó–∞—Ç–µ–º –≤—ã–∑—ã–≤–∞—é—Ç—Å—è —Å–æ–±—ã—Ç–∏—è `AgentChatBloc`
   - –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –í—ã–±–æ—Ä —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–µ—Å—Å–∏–∏
1. –û—Ç–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π
2. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –ª—é–±—É—é —Å–µ—Å—Å–∏—é
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Ä–∞–∑—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è ChatPage —Å empty state –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
4. **–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:** Loader –Ω–∞ –≤—Å—é –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏
1. –û—Ç–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π
2. –ö–ª–∏–∫–Ω—É—Ç—å "New Session"
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Ä–∞–∑—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è ChatPage —Å empty state
4. **–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:** Loader –Ω–∞ –≤—Å—é –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –í–æ–∑–≤—Ä–∞—Ç –∫ —Å–ø–∏—Å–∫—É —Å–µ—Å—Å–∏–π
1. –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç
2. –ö–ª–∏–∫–Ω—É—Ç—å –∫–Ω–æ–ø–∫—É "Back"
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π
4. **–î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:** –ö–∞–∫ –∏ —Ä–∞–Ω—å—à–µ

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è (–Ω–µ –≤—ã–±—Ä–∞–Ω—ã)

### 1. –£–±—Ä–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ `loading` –∏–∑ SessionManagerBloc
**–ú–∏–Ω—É—Å—ã:**
- –ù–∞—Ä—É—à–∞–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω BLoC (—Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–æ–ª–∂–Ω—ã –æ—Ç—Ä–∞–∂–∞—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
- –£–±–∏—Ä–∞–µ—Ç feedback –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö

### 2. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å loader —Ç–æ–ª—å–∫–æ –≤ ChatPage
**–ú–∏–Ω—É—Å—ã:**
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ loader'–∞
- –°–ª–æ–∂–Ω–µ–µ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–ª–∞–≥ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è UI
**–ú–∏–Ω—É—Å—ã:**
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

## –í—ã–≤–æ–¥—ã

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ:
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (2 —Ñ—É–Ω–∫—Ü–∏–∏)
- ‚úÖ –ù–µ –Ω–∞—Ä—É—à–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- ‚úÖ –£–ª—É—á—à–∞–µ—Ç UX (–Ω–µ—Ç –Ω–µ–Ω—É–∂–Ω–æ–≥–æ loader'–∞)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- [`ai_assistant_panel.dart`](lib/features/agent_chat/presentation/widgets/ai_assistant_panel.dart) - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- [`session_list_page.dart`](lib/features/session_management/presentation/pages/session_list_page.dart) - –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [`session_manager_bloc.dart`](lib/features/session_management/presentation/bloc/session_manager_bloc.dart) - –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [`chat_page.dart`](lib/features/agent_chat/presentation/pages/chat_page.dart) - –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
