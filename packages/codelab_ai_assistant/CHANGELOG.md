# Changelog - CodeLab AI Assistant

Все значимые изменения в пакете codelab_ai_assistant будут документированы в этом файле.

## [1.0.0] - 2026-01-21

### Добавлено

**Мультиагентная система:**
- Поддержка 5 специализированных агентов (Orchestrator, Coder, Architect, Debug, Ask)
- Автоматическое переключение агентов на основе контекста задачи
- Ручное переключение агентов через UI
- История переключений с причинами и временными метками
- Цветовая кодировка сообщений по типу агента

**WebSocket интеграция:**
- Подключение к AI Service через Gateway
- Streaming responses с token-by-token отображением
- Обработка различных типов сообщений:
  - `user_message` - сообщения пользователя
  - `assistant_message` - ответы ассистента
  - `tool_call` - вызовы инструментов
  - `tool_result` - результаты выполнения
  - `agent_switch` - переключение агентов
  - `error` - ошибки
- Автоматическое переподключение при разрыве соединения

**Human-in-the-Loop (HITL):**
- Диалоги подтверждения для опасных операций
- Поддержка трех типов решений:
  - `approve` - одобрить операцию
  - `reject` - отклонить операцию
  - `modify` - изменить параметры перед выполнением
- Восстановление pending approvals после перезапуска IDE
- Синхронизация состояния с сервером через ApprovalSyncService
- Персистентность решений для предотвращения повторных запросов

**Выполнение инструментов:**
- Локальное выполнение 9+ инструментов:
  - `read_file` - чтение файлов
  - `write_file` - запись файлов
  - `list_files` - список файлов в директории
  - `execute_command` - выполнение команд
  - `search_files` - поиск по файлам
  - `apply_diff` - применение изменений
  - `ask_followup_question` - запрос дополнительной информации
  - `attempt_completion` - завершение задачи
  - `new_task` - создание новой задачи
- Автоматическая отправка результатов на сервер
- Обработка ошибок выполнения с детальными сообщениями

**Управление сессиями:**
- Создание новых сессий с настраиваемыми параметрами
- Загрузка списка сессий пользователя
- Удаление сессий
- Загрузка истории сообщений сессии
- Сохранение истории локально через SharedPreferences
- Восстановление контекста при переподключении

**Настройки сервера:**
- Конфигурация URL Gateway
- Настройка таймаутов подключения
- Тестирование подключения к серверу
- Сохранение настроек локально
- Валидация URL и параметров

**Clean Architecture:**
- Разделение на слои: Presentation, Domain, Data
- Use Cases для каждой операции:
  - `SendMessageUseCase` - отправка сообщений
  - `ReceiveMessagesUseCase` - получение сообщений
  - `SwitchAgentUseCase` - переключение агентов
  - `ConnectUseCase` - подключение к сессии
  - `LoadHistoryUseCase` - загрузка истории
  - `ExecuteToolUseCase` - выполнение инструментов
  - `CreateSessionUseCase` - создание сессии
  - `ListSessionsUseCase` - список сессий
  - `DeleteSessionUseCase` - удаление сессии
- Repository pattern для абстракции источников данных
- Entity-based domain models
- Обработка ошибок через Either<Failure, T>

**BLoC State Management:**
- `AgentChatBloc` - управление чатом с агентом
- `SessionManagerBloc` - управление сессиями
- `ServerSettingsBloc` - управление настройками сервера
- Предсказуемые переходы состояний
- Логирование всех событий и состояний

### Изменено

- Переход с прямого использования WebSocket на Clean Architecture
- Рефакторинг UI компонентов для лучшей переиспользуемости
- Оптимизация обработки streaming responses
- Улучшена обработка ошибок с детальными сообщениями

### Исправлено

- Исправлены утечки памяти в WebSocket подписках
- Исправлена проблема с бесконечным loader при ошибках
- Исправлена обработка переключения агентов с пустым toAgent
- Исправлена синхронизация pending approvals при переподключении
- Исправлены race conditions в ToolApprovalService

### Удалено

- Удалены устаревшие документы рефакторинга (27 файлов)
- Удалены неиспользуемые модели данных
- Удалены deprecated методы API

## [Unreleased]

### Планируется

**v1.1:**
- Автоматическое переподключение WebSocket
- Offline режим с очередью сообщений
- Улучшенная обработка ошибок с retry механизмом

**v1.2:**
- Поддержка мультимодальности (изображения, файлы)
- Streaming tool execution
- Расширенная аналитика использования
- Кэширование ответов агентов

---

[1.0.0]: https://github.com/your-org/codelab_ide/releases/tag/v1.0.0
