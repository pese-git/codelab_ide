# CodeLab Engine

–î–≤–∏–∂–æ–∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∫–æ–¥–∞ –¥–ª—è CodeLab IDE. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Language Server Protocol (LSP).

**–í–µ—Ä—Å–∏—è**: 1.0.0  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 21 —è–Ω–≤–∞—Ä—è 2026

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º:**
- –û—Ç–∫—Ä—ã—Ç–∏–µ –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∞–º–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤

**–ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 10+ —è–∑—ã–∫–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é
- –ö–∞—Å—Ç–æ–º–∏–∑–∏—Ä—É–µ–º—ã–µ —Ç–µ–º—ã –ø–æ–¥—Å–≤–µ—Ç–∫–∏

### üöß –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

**LSP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- Language Server Protocol –∫–ª–∏–µ–Ω—Ç
- –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞
- Go to definition
- Find references
- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
lib/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ editor_manager_service.dart  # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ file_sync_service.dart       # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lsp_service.dart             # LSP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ editor_state.dart            # –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ file_change.dart             # –ú–æ–¥–µ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îî‚îÄ‚îÄ language_detector.dart       # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞
‚îî‚îÄ‚îÄ codelab_engine.dart                  # –ü—É–±–ª–∏—á–Ω—ã–π API
```

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```yaml
dependencies:
  # Core
  codelab_core: any
  
  # Functional programming
  fpdart: ^1.2.0
  
  # State management
  flutter_bloc: ^9.1.1
  
  # Logging
  logger: ^2.6.2
  
  # File system
  file: ^7.0.1
  path: ^1.9.1
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### EditorManagerService

```dart
import 'package:codelab_engine/codelab_engine.dart';

final editorManager = EditorManagerService();

// –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª
await editorManager.openFile('/path/to/file.dart');

// –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π —Ñ–∞–π–ª
final activeFile = editorManager.activeFile;

// –ó–∞–∫—Ä—ã—Ç—å —Ñ–∞–π–ª
await editorManager.closeFile('/path/to/file.dart');

// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª
await editorManager.saveFile('/path/to/file.dart', content);

// –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤
final openFiles = editorManager.openFiles;
```

### FileSyncService

```dart
import 'package:codelab_engine/codelab_engine.dart';

final syncService = FileSyncService();

// –ù–∞—á–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
syncService.watchFile('/path/to/file.dart');

// –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
syncService.changes.listen((change) {
  print('–§–∞–π–ª –∏–∑–º–µ–Ω–µ–Ω: ${change.path}');
  print('–¢–∏–ø –∏–∑–º–µ–Ω–µ–Ω–∏—è: ${change.type}');
});

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
await syncService.syncChanges();

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
final hasUnsaved = syncService.hasUnsavedChanges('/path/to/file.dart');
```

### LanguageDetector

```dart
import 'package:codelab_engine/codelab_engine.dart';

// –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —è–∑—ã–∫ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ–∞–π–ª–∞
final language = LanguageDetector.detectLanguage('main.dart');
// –í–µ—Ä–Ω–µ—Ç: 'dart'

// –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ–¥—Å–≤–µ—Ç–∫–∏
final highlightConfig = LanguageDetector.getHighlightConfig('dart');

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —è–∑—ã–∫–∞
final isSupported = LanguageDetector.isSupported('dart');
// –í–µ—Ä–Ω–µ—Ç: true
```

## üé® –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏

| –Ø–∑—ã–∫ | –†–∞—Å—à–∏—Ä–µ–Ω–∏—è | –ü–æ–¥—Å–≤–µ—Ç–∫–∞ | LSP |
|------|-----------|-----------|-----|
| Dart | `.dart` | ‚úÖ | üöß |
| Python | `.py` | ‚úÖ | üöß |
| JavaScript | `.js`, `.jsx` | ‚úÖ | üöß |
| TypeScript | `.ts`, `.tsx` | ‚úÖ | üöß |
| Java | `.java` | ‚úÖ | üöß |
| C/C++ | `.c`, `.cpp`, `.h` | ‚úÖ | üöß |
| Go | `.go` | ‚úÖ | üöß |
| Rust | `.rs` | ‚úÖ | üöß |
| HTML | `.html`, `.htm` | ‚úÖ | ‚ùå |
| CSS | `.css`, `.scss` | ‚úÖ | ‚ùå |
| JSON | `.json` | ‚úÖ | ‚ùå |
| YAML | `.yaml`, `.yml` | ‚úÖ | ‚ùå |
| Markdown | `.md` | ‚úÖ | ‚ùå |

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ EditorManager

```dart
final editorManager = EditorManagerService(
  maxOpenFiles: 20,           // –ú–∞–∫—Å–∏–º—É–º –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤
  autoSave: true,             // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
  autoSaveInterval: Duration(seconds: 30),
  tabSize: 2,                 // –†–∞–∑–º–µ—Ä —Ç–∞–±—É–ª—è—Ü–∏–∏
  insertSpaces: true,         // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã –≤–º–µ—Å—Ç–æ —Ç–∞–±–æ–≤
);
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ FileSyncService

```dart
final syncService = FileSyncService(
  syncInterval: Duration(seconds: 5),  // –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
  conflictResolution: ConflictResolution.keepLocal,  // –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
  enableBackup: true,                  // –°–æ–∑–¥–∞–≤–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
);
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
flutter test

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
flutter test test/services/editor_manager_service_test.dart

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å coverage
flutter test --coverage
```

## üìö API Reference

### EditorManagerService

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
|-------|----------|------------|
| `openFile(String path)` | –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ñ–∞–π–ª | `Future<Either<AppError, void>>` |
| `closeFile(String path)` | –ó–∞–∫—Ä—ã–≤–∞–µ—Ç —Ñ–∞–π–ª | `Future<Either<AppError, void>>` |
| `saveFile(String path, String content)` | –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª | `Future<Either<AppError, void>>` |
| `getFileContent(String path)` | –ü–æ–ª—É—á–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ | `Either<AppError, String>` |
| `isFileOpen(String path)` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–∫—Ä—ã—Ç –ª–∏ —Ñ–∞–π–ª | `bool` |

### FileSyncService

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
|-------|----------|------------|
| `watchFile(String path)` | –ù–∞—á–∏–Ω–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ | `void` |
| `unwatchFile(String path)` | –ü—Ä–µ–∫—Ä–∞—â–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ | `void` |
| `syncChanges()` | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è | `Future<void>` |
| `hasUnsavedChanges(String path)` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è | `bool` |
| `discardChanges(String path)` | –û—Ç–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è | `Future<void>` |

### LanguageDetector

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
|-------|----------|------------|
| `detectLanguage(String filePath)` | –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —è–∑—ã–∫ | `String?` |
| `getHighlightConfig(String language)` | –ü–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ–¥—Å–≤–µ—Ç–∫–∏ | `HighlightConfig?` |
| `isSupported(String language)` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É | `bool` |
| `getSupportedLanguages()` | –°–ø–∏—Å–æ–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —è–∑—ã–∫–æ–≤ | `List<String>` |

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤–æ–≥–æ —è–∑—ã–∫–∞

1. –û–±–Ω–æ–≤–∏—Ç–µ `LanguageDetector`:
```dart
class LanguageDetector {
  static const _languageMap = {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —è–∑—ã–∫–∏
    '.mylang': 'mylanguage',
  };
  
  static HighlightConfig? getHighlightConfig(String language) {
    switch (language) {
      // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —è–∑—ã–∫–∏
      case 'mylanguage':
        return HighlightConfig(
          keywords: ['keyword1', 'keyword2'],
          builtins: ['builtin1', 'builtin2'],
          // ...
        );
    }
  }
}
```

2. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã:
```dart
test('should detect mylanguage', () {
  final language = LanguageDetector.detectLanguage('test.mylang');
  expect(language, 'mylanguage');
});
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LSP (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)

```dart
// –ë—É–¥—É—â–∏–π API –¥–ª—è LSP
final lspService = LSPService();

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è LSP —Å–µ—Ä–≤–µ—Ä–∞
await lspService.initialize(
  serverPath: '/path/to/language-server',
  rootPath: '/path/to/project',
);

// –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
final completions = await lspService.getCompletions(
  filePath: 'main.dart',
  position: Position(line: 10, character: 5),
);

// Go to definition
final definition = await lspService.getDefinition(
  filePath: 'main.dart',
  position: Position(line: 10, character: 5),
);
```

## üîç –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UI

```dart
class EditorPage extends StatelessWidget {
  final EditorManagerService editorManager;
  
  @override
  Widget build(BuildContext context) {
    return StreamBuilder<EditorState>(
      stream: editorManager.stateStream,
      builder: (context, snapshot) {
        final state = snapshot.data;
        
        return Column(
          children: [
            // –í–∫–ª–∞–¥–∫–∏ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤
            TabBar(
              tabs: state.openFiles.map((file) => 
                Tab(text: basename(file))
              ).toList(),
            ),
            // –†–µ–¥–∞–∫—Ç–æ—Ä
            Expanded(
              child: CodeEditor(
                content: state.activeFileContent,
                language: LanguageDetector.detectLanguage(
                  state.activeFile,
                ),
                onChanged: (content) {
                  editorManager.updateContent(
                    state.activeFile,
                    content,
                  );
                },
              ),
            ),
          ],
        );
      },
    );
  }
}
```

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- LSP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ —Ñ–∞–π–ª–æ–≤
- –ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã (>10MB) –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é

## üó∫Ô∏è Roadmap

### v1.1 (Q1 2026)
- [x] –ë–∞–∑–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º
- [x] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
- [ ] LSP –∫–ª–∏–µ–Ω—Ç
- [ ] –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞

### v1.2 (Q2 2026)
- [ ] Go to definition
- [ ] Find references
- [ ] Rename refactoring
- [ ] Code formatting

### v2.0 (Q3-Q4 2026)
- [ ] Multi-cursor editing
- [ ] Snippets
- [ ] Code folding
- [ ] Minimap

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. [`../../LICENSE`](../../LICENSE)
