# Техническое задание: Интеграция компиляции Dart CLI и отладчика в CodeLab IDE

---

## 1. Цели задачи

Реализовать:
- Возможность компиляции и запуска CLI‑приложений на Dart в двух режимах: debug и release.
- Полноценный встроенный отладчик для debug-режима: управление точками останова и просмотр переменных во время выполнения, управление выполнением (шаги, продолжение, остановка).

---

## 2. Функциональные требования

### 2.1. Режимы запуска
- Пользователь может выбрать режим запуска (debug/release) перед запуском приложения (например, переключатель или выпадающий список на тулбаре).
- В режиме release выполняется стандартный запуск/компиляция через:
  - `dart compile exe <main.dart>` или `dart run --release <main.dart>`
- В режиме debug приложение запускается с поддержкой дебаггера через:
  - `dart run --observe=<port> <main.dart>` (порт настраиваемый или автоматически выбираемый)

### 2.2. Debugger
- После запуска в debug-режиме IDE автоматически подключается к Dart VM Service через WebSocket.
- Пользователь может:
  - Ставить и снимать breakpoints прямо в редакторе.
  - Видеть список остановок (breakpoints) и их положение.
  - При достижении брейкпоинта видеть текущий call stack.
  - Видеть значения локальных переменных и их изменения в ходе выполнения.
  - Управлять выполнением (Continue, Pause, Step over, Step in, Step out).
  - Перезапускать и останавливать отладочную сессию.
- Все изменения состояния исполнения (break, variable change и др.) отображаются в реальном времени в IDE.

### 2.3. UI
- В редакторе кода отображаются индикаторы breakpoints.
- Специальная панель отображает:
  - Call Stack
  - Locals/Variables
  - Активные breakpoints
  - Кнопки для управления выполнением

### 2.4. Сервисная архитектура
- Реализовать модуль клиента Dart VM Service (желательно на базе package:vm_service).
- Модуль взаимодействует с сервисом запуска процессов/терминалом.
- Модуль устанавливает и поддерживает соединение с VM Service на время debug-сессии.
- При выходе из debug-режима соединение корректно разрывается.

### 2.5. Кроссплатформенность
- Все вышеперечисленное должно работать на Mac, Linux, Windows (минимум — на вашей целевой платформе с возможностью расширить на остальные).

---

## 3. Не-функциональные требования

- Код модульный, следует архитектуре проекта (например, вынести логику VM Service в отдельный пакет).
- Вся логика работы с процессами (запуск/kill/перезапуск) аккуратно отделена от UI.
- UI максимально соответствует привычному для IDE паттерну (слева: breakpoints, stack; в редакторе — точки останова).
- Весь исходный код сопровождается комментариями и юнит‑тестами для бизнес‑логики.
- Реализация не ломает существующие режимы запуска/редактирования/отображения.

---

## 4. Дополнительно (желательно, но не обязательно в первой реализации)

- Возможность запускать несколько debug-сессий для разных процессов.
- Автоопределение свободного порта для VM Service.
- Обработка ошибок при невозможности соединиться с VM или если порт занят.

---

## 5. Ограничения

- Поддержка только CLI-приложений на Dart (не Flutter и не Web).
- Для сложных выражений и инспекции объектов отображать value по реализации VM Service, без пользовательских eval-выражений.
- Проект не должен требовать сторонних closed source решений.

---

## 6. Типовые юзкейсы

1. Пользователь выбирает main.dart, переключает режим на “Debug” и запускает через IDE.
2. Программа стартует с observe-режимом, панель отладчика становится активной.
3. Пользователь устанавливает breakpoint, выполнение стопорится, показывается локальный стек вызова, значения переменных, можно продолжить или пошагово идти.
4. Пользователь переключает режим на “Release”, повторно запускает — отладчик не активируется, работает обычный терминальный вывод.
