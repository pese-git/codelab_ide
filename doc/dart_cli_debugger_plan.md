# План развития: debug/release и отладчик для Dart CLI в CodeLab IDE

---

## 0. Подготовительные шаги (высокий приоритет, без зависимостей)

**0.1. Анализ текущих сервисов запуска и структуры UI**
- Кратко зафиксировать документацию/кастомные интерфейсы, относящиеся к запуску и редактору.
- Проверить/описать, какой компонент сейчас отвечает за сборку/запуск.

---

## 1. Реализация переключения режимов (debug/release)

**1.1. Добавить UI для выбора режима запуска в IDE**
- Расширить тулбар, выпадающее меню или иконку — “Debug”/“Release”.  
- Без изменения логики запуска.
- (Приоритет: **Высокий**, зависит от 0.1)

**1.2. Провести рефакторинг launch-сервиса для поддержки режима**
- Принять новый параметр (debug/release) у функции запуска.
- Оставить старое поведение по-умолчанию (“release”).
- (Приоритет: **Высокий**, зависит от 1.1)

**1.3. Реализовать запуск в режиме debug**
- Запуск приложения с флагом `--observe=<порт>` (флаг по условию, изменения затрагивают сервис и методы запуска).
- Пока ЛИШЬ запуск без подключения debug-панели!
- Проверить что приложение стартует корректно, без влияния на release.
- (Приоритет: **Высокий**, зависит от 1.2)

**1.4. Реализовать запуск в режиме release (явный запуск)**
- Для release: запуск через `dart run --release` или `dart compile exe`.
- (Приоритет: **Высокий**, зависит от 1.2, параллельно с 1.3)

---

## 2. Интеграция клиента VM Service (debug-протокол)

**2.1. Создать модуль-клиент VM Service**
- Обособленный сервис/класс, подключающийся к VM Service через WebSocket (использует package:vm_service).
- Умеет подписываться на события, получать стек, переменные и управлять выполнением.
- Покрыть unit-тестами.
- (Приоритет: **Очень высокий**, может начаться параллельно с 1.3)

**2.2. Реализовать бизнес-логику для breakpoints/stack/variables**
- В этом сервисе: методы для добавления/удаления брейкпоинтов, получение call stack, переменных, пошаговое выполнение, пауза, continue.
- Тесты.
- (Приоритет: **Высокий**, зависит от 2.1)

---

## 3. Внедрение дебаг-сервиса в launch flow

**3.1. Интегрировать VM Service-клиент в debug start**
- При запуске в debug-режиме IDE автоматически подключает debug-сервис к VM Service.
- Если соединение не удалось — информировать пользователя (не ломать основной Run).
- (Приоритет: **Высокий**, зависит от 1.3 + 2.2)

---

## 4. Реализация UI debugger-панели

**4.1. Реализовать UI для управления дебаггером**
- Debug-panel: отображение call stack, breakpoints, переменных, кнопки управления (Continue, Step...).
- Мягкая интеграция (панель не активна если не debug-сессия или сервис выключен).
- (Приоритет: **Средний**, зависит от 2.2, может разрабатываться параллельно с 3.1)

**4.2. Реализовать визуальные брейкпоинты в редакторе**
- Индикаторы в маргинесе редактора, клик для установки/снятия, синхронизация с VM Service.
- (Приоритет: **Средний**, зависит от 4.1)

**4.3. Mark-up текущей строки исполнения**
- Подсветка active stack frame в редакторе.
- (Приоритет: **Средний**, зависит от 4.2)

---

## 5. Ошибки и устойчивость (edge-cases)

**5.1. Обработка ошибок соединения и портов**
- Сообщения о занятости порта или невозможности подключения.
- Автовыбор свободного порта (если возможно).
- (Приоритет: **Высокий**, зависит от 3.1, 2.1)

**5.2. Обработка прерывания debug-сессии**
- Корректное завершение соединения, очистка UI.
- (Приоритет: **Высокий**, зависит от 3.1)

---

## 6. Документация и тестирование

**6.1. Документация по новому функционалу**
- USER GUIDE: как пользоваться debug/release.
- TECH: как работает архитектура.
- (Приоритет: **Средний**, после внедрения 4.X)

**6.2. Расширить unit/integration-тесты**
- Для бизнес-логики и интеграции VM Service.
- (Параллельно другим таскам, по мере реализации)

---

## Визуализация зависимостей

```
         [0.1]
           |
        [1.1]
           |
        [1.2]
         /   \ 
     [1.3]  [1.4]
         |
     [3.1]---[2.1]
       |      |
       |    [2.2]
       |      |
      [5.1]  [4.1]
         |      |
      [5.2]   [4.2]
                   |
                [4.3]
                   |
                [6.1]
```
(Тесты [6.2] — параллельно всему)

---

## Приоритеты

- **Критические**: 0, 1 (выбор режима и запуск), 2 (клиент VM Service), 3 (интеграция debug, ошибки), 5 (устойчивость).
- **Средние**: 4 (UI), 6 (документация).
