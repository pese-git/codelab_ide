# –û—Ç—á–µ—Ç –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ CodeLab IDE

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

### ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ WebSocket (–≠—Ç–∞–ø 1 - –í–´–ü–û–õ–ù–ï–ù)

1. **–î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π –≤ `ws_message.dart`:**
   - `WSMessage.planNotification` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–ª–∞–Ω–µ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
   - `WSMessage.planUpdate` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞–Ω–∞
   - `WSMessage.planProgress` - –ø—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–æ–≤ –ø–ª–∞–Ω–∞
   - `WSMessage.planApproval` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞

2. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö `message_model.dart`:**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: `planId`, `steps`, `currentStep`, `stepId`, `status`, `decision`, `feedback`
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ `_parseContent()` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–æ–ª–µ–π –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω `message_mapper.dart`:**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ `fromWSMessage()`
   - –°–æ–∑–¥–∞–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ `Message` entities –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞:**
   - –ó–∞–ø—É—â–µ–Ω `build_runner` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Freezed –∫–ª–∞—Å—Å–æ–≤
   - –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
   - –ü—Ä–æ—Ö–æ–¥–∏—Ç –∞–Ω–∞–ª–∏–∑ `flutter analyze`

### üìã –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

#### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `PLAN_PENDING_CONFIRMATION` - –ø–ª–∞–Ω —Å–æ–∑–¥–∞–Ω, –æ–∂–∏–¥–∞–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `PLAN_EXECUTING` - –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—ç—Ç–∞–ø–Ω–æ
- `PLAN_COMPLETED` - –≤—Å–µ —à–∞–≥–∏ –ø–ª–∞–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã

#### –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π
- `plan_notification` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–ª–∞–Ω –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∫–∞–∑–∞ –¥–∏–∞–ª–æ–≥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- `plan_update` –ø–µ—Ä–µ–¥–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —à–∞–≥–æ–≤ –∏ —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- `plan_progress` —Å–æ–æ–±—â–∞–µ—Ç –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —à–∞–≥–æ–≤
- `plan_approval` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—É –∂–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, —á—Ç–æ –∏ HITL –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å `AgentChatBloc` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ—Ç–æ–∫–æ–≤—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebSocket

## –°–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 2: BLoC –ª–æ–≥–∏–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π)
- –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ `AgentChatBloc`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤—Ö–æ–¥—è—â–∏—Ö `plan_notification` —Å–æ–æ–±—â–µ–Ω–∏–π
- –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –ø–ª–∞–Ω–æ–≤ —á–µ—Ä–µ–∑ `plan_approval`

### –≠—Ç–∞–ø 3: UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- –°–æ–∑–¥–∞—Ç—å `PlanNotificationDialog` –≤ –ø–∞–∫–µ—Ç–µ `codelab_uikit`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `ReasoningPanel` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `AI Assistant Panel`

### –≠—Ç–∞–ø 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°–≤—è–∑–∞—Ç—å UI —Å –ª–æ–≥–∏–∫–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ñ–ª–æ—É: –ø–ª–∞–Ω ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –û–±—Ä–∞–±–æ—Ç–∞—Ç—å edge cases –∏ –æ—à–∏–±–∫–∏

## –§–∞–π–ª—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –¢–µ–∫—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–≤—ã–ø–æ–ª–Ω–µ–Ω—ã):
- ‚úÖ `lib/features/agent_chat/data/models/ws_message.dart`
- ‚úÖ `lib/features/agent_chat/data/models/message_model.dart`
- ‚úÖ `lib/features/agent_chat/data/mappers/message_mapper.dart`

### –°–ª–µ–¥—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- üîÑ `lib/features/agent_chat/presentation/bloc/agent_chat_bloc.dart` - –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —Å–æ–±—ã—Ç–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- üîÑ `packages/codelab_uikit/lib/widgets/` - —Å–æ–∑–¥–∞—Ç—å UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- üîÑ `lib/features/agent_chat/presentation/widgets/ai_assistant_panel.dart` - –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å UI

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è:
1. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `agent-runtime` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
2. –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ñ–ª–æ—É –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ edge cases

## –û—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç

- **–≠—Ç–∞–ø 1**: ‚úÖ 4-6 —á–∞—Å–æ–≤ (–ø—Ä–æ—Ç–æ–∫–æ–ª –∏ –º–æ–¥–µ–ª–∏)
- **–≠—Ç–∞–ø 2**: üîÑ 6-8 —á–∞—Å–æ–≤ (BLoC –ª–æ–≥–∏–∫–∞)
- **–≠—Ç–∞–ø 3**: üîÑ 8-12 —á–∞—Å–æ–≤ (UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
- **–≠—Ç–∞–ø 4**: üîÑ 4-6 —á–∞—Å–æ–≤ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

**–ò—Ç–æ–≥–æ: ~22-32 —á–∞—Å–∞** –Ω–∞ –ø–æ–ª–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

## –†–∏—Å–∫–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∏—Å–∫–∏:
- –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ API –º–µ–∂–¥—É IDE –∏ agent-runtime
- –°–ª–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø—Ä–∏ –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–æ–º –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
- UX –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `agent-runtime` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π
- –í–æ–∑–º–æ–∂–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–∞–Ω–Ω—ã—Ö –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–∞—á–∞—Ç—å —Å BLoC** - –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–±—ã—Ç–∏–π –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã** - —Å–ª–µ–¥–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ HITL
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—ç—Ç–∞–ø–Ω–æ** - —Å–Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, –∑–∞—Ç–µ–º UI
4. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å API** - –æ–±–Ω–æ–≤–∏—Ç—å `agent_extended_protocol.md`

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ—Ç–æ–∫–æ–ª –∏ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è. IDE –∏–º–µ–µ—Ç –æ—Ç–ª–∏—á–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –±–∞–∑—É –¥–ª—è —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏. –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –≤–∫–ª—é—á–∞—é—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –≤ BLoC –∏ —Å–æ–∑–¥–∞–Ω–∏–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.